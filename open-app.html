<!DOCTYPE html>
<html>
  <head>
    <title>Opening App...</title>
    <script>
      function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }

      function openApp() {
        const queryParams = getQueryParams();
        const userId = queryParams.userId || 'defaultUser';
        const token = queryParams.token || 'defaultToken';


        const isAndroid = /Android/i.test(navigator.userAgent);
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);

        const deepLink = `myapp://open?userId=${userId}&token=${token}`;

        if (isAndroid) {
          // Try to open the app
          window.location.href = deepLink;

          // Fallback to App Distribution after a short delay
          setTimeout(() => {
            window.location.href = "https://appdistribution.firebase.google.com/testerapps/android:com.retargeting.app/install";
          }, 2000);
        } else if (isIOS) {
          // Use hidden iframe to try opening app
          const iframe = document.createElement("iframe");
          iframe.style.display = "none";
          iframe.src = deepLink;
          document.body.appendChild(iframe);

          // Fallback to iOS Firebase App Distribution link
          setTimeout(() => {
            window.location.href = "https://appdistribution.firebase.google.com/testerapps/ios:com.adikteev.retargeting.distribution/install";
          }, 2000);
        } else {
          document.body.innerHTML = "Unsupported device.";
        }
      }
    </script>
  </head>
  <body onload="openApp()">
    <p>Opening the app...</p>
  </body>
</html>
